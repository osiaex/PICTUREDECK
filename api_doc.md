# 前后端交互接口文档

## 接口概览

| 模块         | URI                                | 方法   | 功能                                                |
| :----------- | :--------------------------------- | :----- | :-------------------------------------------------- |
| **用户管理** | `/api/v1/auth/register`            | `POST` | [注册](#注册接口)                                   |
| **用户管理** | `/api/v1/auth/login`               | `POST` | [登录](#登录接口)                                   |
| **用户管理** | `/api/v1/auth/forgot-password`     | `POST` | [忘记密码，请求发送邮件](#忘记密码请求发送邮件接口) |
| **用户管理** | `/api/v1/auth/reset-password`      | `POST` | [忘记密码，请求重置密码](#忘记密码重置密码接口)     |
| **用户管理** | `/api/v1/user/reset-password`      | `POST` | [修改密码](#修改密码接口)                           |
| **用户管理** | `/api/v1/user/reset-email`         | `POST` | [修改邮箱](#修改邮箱接口)                           |
| **内容管理** | `/api/v1/user/generation_list`     | `GET`  | [获取历史生成记录](#获取历史生成记录接口)           |
| **内容管理** | `/api/v1/user/favorite_list`       | `GET`  | [获取收藏夹](#获取收藏夹接口)                       |
| **内容管理** | `/api/v1/user/favorite_list`       | `POST`  | [新增收藏夹内容](#新增收藏夹内容接口)                       |
| **内容管理** | `/api/v1/user/favorite_list/{collection_id}`       | `DELETE`  | [删除收藏夹内容](#删除收藏夹内容接口)                       |
| **内容生成** | `/api/v1/generation`               | `POST` | [发起生成任务](#发起生成任务接口)                   |
| **内容生成** | `/api/v1/upload`                   | `POST` | [上传参考图片](#上传参考图片接口)                   |
| **内容生成** | `/api/v1/generation/{taskId}`      | `GET`  | [查询生成结果](#查询生成结果接口)                   |
| **内容生成** | `result_url`（由查询结果响应指定） | `GET`  | [获得生成结果](#获取生成结果接口)                   |
| **内容管理** | `/api/v1/user/generation_list` | `POST`  | [删除生成记录](#删除生成记录接口)   
| **内容管理** | `/api/v1/user/favorite_list/batch`       | `POST`  | [批量新增收藏夹内容](#批量新增收藏夹内容接口)                       |

## 补充说明

对过期token返回HTTP状态码401 

## 接口详述

### 1. 注册接口<span id="注册接口"></span>

- **URI**: `/api/v1/auth/register`
- **方法**: `POST`
- **功能**: 注册新用户

**请求体示例**:

```json
{
  "account": "test_user",
  "email": "test@example.com",
  "password": "User@1234"
}
```

**请求参数说明**:

| 参数名     | 类型   | 说明                     | 约束 |
| :--------- | :----- | :----------------------- | :--- |
| `account`  | string | 账号                     | 唯一 |
| `email`    | string | 用户邮箱（用于找回密码） | 唯一 |
| `password` | string | 用户密码                 |      |

**响应体示例**:

```json
{
  "code": 200,
  "message": "注册成功",
  "data": {
    "account": "test_user",
    "email": "test@example.com",
    "created_at": "2025-10-30T14:10:00Z"
  }
}
```

**响应体参数说明**:

| 参数名            | 类型   | 说明         | 约束                                                                                                            |
| :---------------- | :----- | :----------- | :-------------------------------------------------------------------------------------------------------------- |
| `code`            | int    | 状态码       | 200（成功）；400（失败，参数不合规）；401（失败，账号重复）；402（失败，邮箱重复）；500（失败，服务器内部错误） |
| `data`            | object | 用户注册信息 |                                                                                                                 |
| `data.created_at` | string | 注册时间     |                                                                                                                 |

### 2. 登录接口<span id="登录接口"></span>

- **URI**: `/api/v1/auth/login`
- **方法**: `POST`
- **功能**: 用户登录

**请求体示例**:

```json
{
  "account": "test_user",
  "password": "User@1234"
}
```

**请求参数说明**:

| 参数名     | 类型   | 说明     | 约束 |
| :--------- | :----- | :------- | :--- |
| `account`  | string | 账号     |      |
| `password` | string | 用户密码 |      |

**响应体示例**:

```json
{
  "code": 200,
  "message": "登录成功",
  "data": {
    "account": "test_user",
    "email": "test@example.com",
    "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_expire_at": "2025-11-30T14:30:00Z"
  }
}
```

**响应体参数说明**:

| 参数名                 | 类型   | 说明                     | 约束                                                                                           |
| :--------------------- | :----- | :----------------------- | :--------------------------------------------------------------------------------------------- |
| `code`                 | int    | 状态码                   | 200（成功）；400（失败，参数不合规）；401（失败，账号或密码错误）；500（失败，服务器内部错误） |
| `data`                 | object | 用户信息                 |                                                                                                |
| `data.token`           | string | 令牌，用于后续接口鉴权   |                                                                                                |
| `data.token_expire_at` | string | 令牌过期时间（UTC 时间） |                                                                                                |

### 3. 忘记密码，请求发送邮件接口<span id="忘记密码请求发送邮件接口"></span>

- **URI**: `/api/v1/auth/forgot-password`
- **方法**: `POST`
- **功能**: 忘记密码流程中，请求系统向用户邮箱发送重置链接/验证码

**请求体示例**:

```json
{
  "email": "test@example.com"
}
```

**请求参数说明**:

| 参数名  | 类型   | 说明                 | 约束 |
| :------ | :----- | :------------------- | :--- |
| `email` | string | 用户注册时使用的邮箱 |      |

**响应体示例**:

```json
{
  "code": 200,
  "message": "邮件已发送"
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                       |
| :----- | :--- | :----- | :----------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，邮箱未注册）；500（失败，服务器内部错误） |

### 4. 忘记密码，重置密码接口<span id="忘记密码重置密码接口"></span>

- **URI**: `/api/v1/auth/reset-password`
- **方法**: `POST`
- **功能**: 忘记密码流程中，用户提交验证码和新密码以重置密码

**请求体示例**:

```json
{
  "email": "test@example.com",
  "verification_code": "123456",
  "new_password": "User@5678"
}
```

**请求参数说明**:

| 参数名              | 类型   | 说明                   | 约束 |
| :------------------ | :----- | :--------------------- | :--- |
| `email`             | string | 用户注册时使用的邮箱   |      |
| `verification_code` | string | 系统发送到邮箱的验证码 |      |
| `new_password`      | string | 新密码                 |      |

**响应体示例**:

```json
{
  "code": 200,
  "message": "成功重置密码"
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                             |
| :----- | :--- | :----- | :----------------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，验证码错误或过期）；500（失败，服务器内部错误） |

### 5. 修改密码接口<span id="修改密码接口"></span>

- **URI**: `/api/v1/user/reset-password`
- **方法**: `POST`
- **功能**: 用户在登录状态下修改密码

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体示例**:

```json
{
  "old_password": "User@1234",
  "new_password": "User@5678"
}
```

**请求参数说明**:

| 参数名         | 类型   | 说明   | 约束 |
| :------------- | :----- | :----- | :--- |
| `old_password` | string | 旧密码 |      |
| `new_password` | string | 新密码 |      |

**响应体示例**:

```json
{
  "code": 200,
  "message": "成功修改密码"
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                         |
| :----- | :--- | :----- | :------------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，旧密码不正确）；500（失败，服务器内部错误） |

### 6. 修改邮箱接口<span id="修改邮箱接口"></span>

- **URI**: `/api/v1/user/reset-email`
- **方法**: `POST`
- **功能**: 用户在登录状态下修改邮箱

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体示例**:

```json
{
  "new_email": "newtest@example.com"
}
```

**请求参数说明**:

| 参数名      | 类型   | 说明   | 约束 |
| :---------- | :----- | :----- | :--- |
| `new_email` | string | 新邮箱 |      |

**响应体示例**:

```json
{
  "code": 200,
  "message": "成功修改邮箱",
  "data": {
    "email": "newtest@example.com"
  }
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                     |
| :----- | :--- | :----- | :--------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，邮箱重复）；500（失败，服务器内部错误） |

### 7. 获取历史生成记录接口<span id="获取历史生成记录接口"></span>

- **URI**: `/api/v1/user/generation_list`
- **方法**: `GET`
- **功能**: 获取用户的历史内容生成记录列表

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**: N/A (GET 方法无请求体)

**响应体示例**:

```json
{
  "code": 200,
  "message": "成功",
  "data": [
    {
      "task_id": "task_10001",
      "created_at": "2025-11-04T17:00:00Z",
      "type": "i2i",
      "prompt": "让上传的照片呈现出油画效果",
      "parameters": {},
      "result_url": "/generated_outputs/67890.txt"
    }
  ]
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                     |
| :----- | :--- | :----- | :--------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，鉴权失败）；500（失败，服务器内部错误） |
| `data` | array<obj>  | 生成历史记录的列表 | 记录应该**按照时间升序排列**，即：时间早的记录靠前，时间晚的记录靠后 |

### 8. 获取收藏夹接口<span id="获取收藏夹接口"></span>

- **URI**: `/api/v1/user/favorite_list`
- **方法**: `GET`
- **功能**: 获取用户的收藏夹

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**: N/A (GET 方法无请求体)

**响应体示例**:

```json
{
  "code": 200,
  "message": "成功获取收藏夹列表",
  "data": [
    {
      "id": 1,
      "parent_id": null,
      "name": "/",
      "node_type": "folder"
    },
    {
      "id": 2,
      "parent_id": 1,
      "name": "man.jpg",
      "node_type": "file",
      "refer_url":"/generated_outputs/man.jpg"
    }
  ]
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                     |
| :----- | :--- | :----- | :--------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，鉴权失败）；500（失败，服务器内部错误） |
| `data.id` | int  | 节点标识 | 唯一 |
| `data.parent_id` | int  | 父节点标识 | 唯一，值为null标识没有父节点 |
| `data.name` | string  | 人类可读的节点名称，所有用户都有且仅有一个根节点，该节点的name为"/" |   |
| `data.node_type` | string  | 节点类型 | 为"folder"或者"file"  |
| `data.refer_url` | string  | 文件的url | 唯一，仅当node_type为"file"时有意义 |

### 9. 新增收藏夹内容接口<span id="新增收藏夹内容接口"></span>

- **URI**: `/api/v1/user/favorite_list`
- **方法**: `POST`
- **功能**: 新增收藏夹内容，即在collections表中多插入一条记录

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**:

```json
{
  "parent_id": 1,
  "name": "example.png",
  "node_type": "file",
  "refer_url":"/generated_outputs/example.png"
}
```

**请求参数说明**:

| 参数名      | 类型   | 说明   | 约束 |
| :---------- | :----- | :----- | :--- |
| `parent_id` | int | 新节点的父节点的标识 | 唯一     |
| `name` | string | 新节点的名称 |    |
| `refer_url` | string | 新节点的url |  仅对文件节点有意义  |

**响应体示例**:

```json
{
  "code": 200,
  "message": "成功创建新收藏内容",
  "data": {
    "id": 32
  }
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                     |
| :----- | :--- | :----- | :--------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，鉴权失败）；500（失败，服务器内部错误） |
| data.id | int  | 新增节点的标识符 | 唯一 |

### 10. 删除收藏夹内容接口<span id="删除收藏夹内容接口"></span>

- **URI**: `/api/v1/user/favorite_list/{collectionid}`
- **方法**: `DELETE`
- **功能**: 删除collectionid指定的收藏记录，这将递归的删除其下的所有子节点

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**: N/A (无请求体，必要的信息在url里)

**请求参数说明**:

| 参数名      | 类型   | 说明   | 约束 |
| :---------- | :----- | :----- | :--- |
| `id` | int | 删除节点的id | 唯一     |


**响应体示例**:

```json
{
  "code": 200,
  "message": "删除收藏夹内容成功",
  "data": [
    {
      "id": 1,
      "name": "/"
    },
    {
      "id": 2,
      "name": "man.jpg"
    }
  ]
}
```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                     |
| :----- | :--- | :----- | :--------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，鉴权失败）；500（失败，服务器内部错误） |
| data | array  | 被删除节点的一些信息 |  |

### 11. 发起生成任务接口<span id="发起生成任务接口"></span>

- **URI**: `/api/v1/generation`
- **方法**: `POST`
- **功能**: 发起新的内容生成任务（如文生图、图生图等）

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体示例**:

```json
{
  "type": "i2i",
  "prompt": "让上传的照片呈现出油画效果",
  "parameters": {},
  "image": "{完成上传后服务器返回的file_id}"
}
```

**请求参数说明**:

| 参数名   | 类型   | 说明                     | 约束                                                                                   |
| :------- | :----- | :----------------------- | :------------------------------------------------------------------------------------- |
| `type`   | string | 任务类型                 | 可选值: "t2i"（文生图）；"i2i"（参考图生图）；"t2v"（文生视频）；"i2v"（关键帧生视频） |
| `prompt` | string | 文本提示词               |                                                                                        |
| `images` | array  | 一组参考图片 URL，可为空 |                                                                                        |

**响应体示例**:

```json
{
  "code": 200,
  "message": "生成任务已创建",
  "data": {
    "task_id": "task_10001",
    "created_at": "2025-11-04T17:00:00Z",
    "type": "i2i",
    "prompt": "让上传的照片呈现出油画效果",
    "parameters": {},
    "image": "{完成上传后服务器返回的file_id}"
  }
}
```

**响应体参数说明**:

| 参数名         | 类型   | 说明              | 约束                                                              |
| :------------- | :----- | :---------------- | :---------------------------------------------------------------- |
| `code`         | int    | 状态码            | 200（成功）；400（失败，参数不合规）；500（失败，服务器内部错误） |
| `data.task_id` | string | 系统生成的任务 ID | 唯一                                                              |

### 12. 上传参考图片接口<span id="上传参考图片接口"></span>

- **URI**: `/api/v1/upload`
- **方法**: `POST`
- **功能**: 上传图片作为内容生成任务的参考图

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |
| `Content-Type`  | string | 值为`image/{具体文件格式}`        |

**请求体**: 上传的图片文件

**响应体示例**:

```json
{
  "code": 200,
  "message": "上传成功",
  "data": {
    "file_id": "ref_10231"
  }
}
```

**响应体参数说明**:

| 参数名          | 类型   | 说明                   | 约束                                                              |
| :-------------- | :----- | :--------------------- | :---------------------------------------------------------------- |
| `code`          | int    | 状态码                 | 200（成功）；400（失败，参数不合规）；500（失败，服务器内部错误） |
| `data.file_id`  | string | 图片在系统中的临时 ID  | 唯一                                                              |
| `data.file_url` | string | 图片在系统中的临时 URL | 唯一                                                              |

### 13. 查询生成结果接口<span id="查询生成结果接口"></span>

- **URI**: `/api/v1/generation/{taskId}`
- **方法**: `GET`
- **功能**: 根据任务 ID 查询内容生成任务的执行状态和结果 URL

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**: N/A (GET 方法无请求体)

**响应体示例**:

```json
{
  "code": 200,
  "message": "任务完成",
  "data": {
    "task_id": "task_10001",
    "status": "completed",
    "result_url": "/generated_outputs/task_10001.png",
    "created_at": "2025-11-04T17:00:00Z",
    "completed_at": "2025-11-04T17:00:15Z"
  }
}
```

**响应体参数说明**:

| 参数名            | 类型   | 说明                           | 约束                                                              |
| :---------------- | :----- | :----------------------------- | :---------------------------------------------------------------- |
| `code`            | int    | 状态码                         | 200（成功）；400（失败，参数不合规）；500（失败，服务器内部错误） |
| `data.status`     | string | 任务的状态                     | 可选值: processing; completed; failed                             |
| `data.result_url` | string | 可选，指定完成的生成结果的 URL |                                                                   |

### 14. 获取生成结果接口<span id="获取生成结果接口"></span>

- **URI**: `result_url`（由查询生成结果的响应指定）
- **方法**: `GET`
- **功能**: 通过特定的 URL 地址获取最终生成的图片或视频文件

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**: N/A (GET 方法无请求体)

**响应体**: 生成的图片或视频文件（二进制数据流）

### 15. 删除生成记录接口<span id="删除生成记录接口"></span>

- **URI**: `/api/v1/user/generation_list`
- **方法**: `POST`
- **功能**: 通过生成结果的URL地址，移除关联的生成记录与对应的收藏项。**后端未必要真的删除生成记录与生成结果**，只是令其对发起删除请求的用户不可见。

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**:
```json
{
  "result_url": "/generated_outputs/67890.txt",
}
```

**请求参数说明**:

| 参数名 | 类型   | 说明   | 约束                                                                                   |
| :------- | :----- | :--------- | :--------------------------------------------------- |

| `result_url` | str  | 与生成记录关联的结果url，用于指定需要删除的记录 |

**响应体**:
```json
{
  "code": 200,
  "message": "生成记录内容成功",
  "data":{
    "result_url": "/generated_outputs/67890.txt"
  }
}
```

| 参数名 | 类型 | 说明   | 约束                                                                                     |
| :----- | :--- | :----- | :--------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，鉴权失败）；500（失败，服务器内部错误） |
| `data.result_url` | obj  | 被删除的生成记录的url |  |


### 16. 批量新增收藏夹内容接口<span id="批量新增收藏夹内容接口"></span>

- **URI**: `/api/v1/user/favorite_list/batch`
- **方法**: `POST`
- **功能**: 批量新增收藏夹内容，即在collections表中一次性插入多条记录，复杂之处在于**新记录的父节点可能仍然是新记录，而新纪录是没有真实id的，故客户端会为所有新纪录设计一个临时id**

**请求头 (Headers)**:

| 字段名          | 类型   | 说明                              |
| :-------------- | :----- | :-------------------------------- |
| `Authorization` | string | 值为`Bearer `，用于身份认证与鉴权 |

**请求体**:

```json
{
  "items": [
    {
      "temp_id": 1,
      "parent_id": 10,
      "name": "A",
      "node_type": "folder"
    },
    {
      "temp_id": 2,
      "parent_temp_id": 1,
      "name": "B",
      "node_type": "folder"
    },
    {
      "temp_id": 3,
      "parent_temp_id": 2,
      "name": "c.png",
      "node_type": "file",
      "refer_url": "/outputs/c.png"
    }
  ]
}



```

**请求参数说明**:

| 参数名      | 类型   | 说明   | 约束 |
| :---------- | :----- | :----- | :--- |
| `temp_id` | int | 新节点的临时标识，这个id只是由客户端给出的| 客户端保证在该请求中唯一     |
| `parent_id` | int | 新节点的父节点的标识，这个id是真实存在于后端中的 | 客户端保证parent_id和parent_temp_id是互斥的，一个节点不可能同时拥有parent_id和parent_temp_id  |
| `parent_temp_id` | int | 新节点的父节点的临时标识，这个id的值一定会是temp_id中的某一个 | 客户端保证其值一定能在temp_id中找到 |
| `name` | string | 新节点的名称 |    |
| `refer_url` | string | 新节点的url |  仅对文件节点有意义  |

**响应体示例**:

```json
{
  "code": 200,
  "message": "批量创建成功",
  "data": {
    "mapping": {
      "1": 32,
      "2": 33,
      "3": 34
    }
  }
}

```

**响应体参数说明**:

| 参数名 | 类型 | 说明   | 约束                                                                                     |
| :----- | :--- | :----- | :--------------------------------------------------------------------------------------- |
| `code` | int  | 状态码 | 200（成功）；400（失败，参数不合规）；401（失败，鉴权失败）；500（失败，服务器内部错误） |
| data.mapping | map  | 这是从临时id到真实id的映射 |  |
